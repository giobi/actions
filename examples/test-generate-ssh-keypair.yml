name: Test SSH Key Pair Generation

on:
  workflow_dispatch:

jobs:
  test-ssh-key-generation:
    uses: ./.github/workflows/generate-ssh-keypair.yml
    with:
      private_key_secret_name: "TEST_SSH_PRIVATE"
      public_key_var_name: "TEST_SSH_PUBLIC"
      key_type: "rsa"
      key_bits: 2048
      key_comment: "test key generated by GitHub Actions"

  verify-outputs:
    needs: test-ssh-key-generation
    runs-on: ubuntu-latest
    steps:
      - name: Display test results
        run: |
          echo "Test Results:"
          echo "============="
          echo "Private key secret name: ${{ needs.test-ssh-key-generation.outputs.private_key_name }}"
          echo "Public key variable name: ${{ needs.test-ssh-key-generation.outputs.public_key_name }}"
          echo "Key fingerprint: ${{ needs.test-ssh-key-generation.outputs.key_fingerprint }}"
          echo "Success: ${{ needs.test-ssh-key-generation.outputs.success }}"
          echo ""
          
          if [ "${{ needs.test-ssh-key-generation.outputs.success }}" = "true" ]; then
            echo "✅ SSH key pair generation test PASSED"
            echo "The workflow successfully:"
            echo "- Generated an SSH key pair"
            echo "- Stored private key in secrets"
            echo "- Stored public key in variables" 
            echo "- Returned proper outputs"
          else
            echo "❌ SSH key pair generation test FAILED"
            exit 1
          fi